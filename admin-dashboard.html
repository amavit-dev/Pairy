<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Au Pair Admin Dashboard - User Management and Content Moderation">
  <title>Admin Dashboard - Pairy</title>
  
  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- Custom Styles -->
  <link rel="stylesheet" href="./css/main.css">
  
  <style>
    :root {
      --primary-pink: #FFB6C1;
      --medium-pink: #FFA6B6;
      --light-pink: #FFE4E9;
      --pale-pink: #FFF0F3;
    }
    
    body {
      background: linear-gradient(135deg, var(--pale-pink) 0%, var(--light-pink) 100%);
      min-height: 100vh;
    }
    
    .tab-button {
      transition: all 0.3s ease;
    }
    
    .tab-button.active {
      background-color: var(--primary-pink);
      color: white;
    }
    
    .stat-card {
      background: linear-gradient(135deg, #FFE4E9, #FFF0F3);
      transition: transform 0.3s ease;
    }
    
    .stat-card:hover {
      transform: translateY(-2px);
    }
    
    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
    }
    
    .modal.active {
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .table-row:hover {
      background-color: #FFF0F3;
    }
  </style>
</head>
<body>
  <!-- Header -->
  <header class="bg-white shadow-md">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
      <div class="flex justify-between items-center">
        <div class="flex items-center gap-4">
          <img
src="./images/logo.png"
alt="Pairy Logo"
class="w-16 h-16 object-contain"
>
          <div>
            <h1 class="text-2xl font-bold text-gray-800">
              Admin Dashboard
              <span class="ml-2 px-3 py-1 bg-yellow-200 text-yellow-800 text-xs font-semibold rounded-full uppercase">Admin</span>
            </h1>
            <p class="text-sm text-gray-600 mt-1">Welcome, <span id="admin-name" class="font-semibold"></span></p>
          </div>
        </div>
        <button onclick="logout()" class="bg-pink-400 hover:bg-pink-500 text-white px-6 py-2 rounded-lg font-medium transition-colors">
          Logout
        </button>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    
    <!-- Statistics Cards -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
      <div class="stat-card bg-white rounded-lg shadow-md p-6">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-gray-600 text-sm font-medium">Total Users</p>
            <p class="text-3xl font-bold text-pink-500 mt-2" id="stat-users">0</p>
          </div>
          <div class="text-4xl">üë•</div>
        </div>
      </div>
      
      <div class="stat-card bg-white rounded-lg shadow-md p-6">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-gray-600 text-sm font-medium">Total Threads</p>
            <p class="text-3xl font-bold text-pink-500 mt-2" id="stat-threads">0</p>
          </div>
          <div class="text-4xl">üí¨</div>
        </div>
      </div>
      
      <div class="stat-card bg-white rounded-lg shadow-md p-6">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-gray-600 text-sm font-medium">Total Posts</p>
            <p class="text-3xl font-bold text-pink-500 mt-2" id="stat-posts">0</p>
          </div>
          <div class="text-4xl">üìù</div>
        </div>
      </div>
      
      <div class="stat-card bg-white rounded-lg shadow-md p-6">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-gray-600 text-sm font-medium">Categories</p>
            <p class="text-3xl font-bold text-pink-500 mt-2">4</p>
          </div>
          <div class="text-4xl">üìÇ</div>
        </div>
      </div>
    </div>

    <!-- Additional Statistics Row -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
      <div class="stat-card bg-white rounded-lg shadow-md p-6">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-gray-600 text-sm font-medium">Total Messages</p>
            <p class="text-3xl font-bold text-pink-500 mt-2" id="stat-messages">0</p>
          </div>
          <div class="text-4xl">‚úâÔ∏è</div>
        </div>
      </div>
      
      <div class="stat-card bg-white rounded-lg shadow-md p-6">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-gray-600 text-sm font-medium">Active Conversations</p>
            <p class="text-3xl font-bold text-pink-500 mt-2" id="stat-conversations">0</p>
          </div>
          <div class="text-4xl">üí¨</div>
        </div>
      </div>
      
      <div class="stat-card bg-white rounded-lg shadow-md p-6">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-gray-600 text-sm font-medium">Users with Usernames</p>
            <p class="text-3xl font-bold text-pink-500 mt-2" id="stat-usernames">0</p>
          </div>
          <div class="text-4xl">üë§</div>
        </div>
      </div>
    </div>

    <!-- Tabs Navigation -->
    <div class="bg-white rounded-lg shadow-md mb-6">
      <div class="flex flex-wrap border-b border-gray-200">
        <button class="tab-button active px-6 py-3 font-medium text-gray-700 hover:bg-pink-50" onclick="switchTab('overview')">
          Overview
        </button>
        <button class="tab-button px-6 py-3 font-medium text-gray-700 hover:bg-pink-50" onclick="switchTab('users')">
          User Management
        </button>
        <button class="tab-button px-6 py-3 font-medium text-gray-700 hover:bg-pink-50" onclick="switchTab('threads')">
          Thread Moderation
        </button>
        <button class="tab-button px-6 py-3 font-medium text-gray-700 hover:bg-pink-50" onclick="switchTab('posts')">
          Post Moderation
        </button>
      </div>
    </div>

    <!-- Tab Content -->
    <div id="tab-content">
      
      <!-- Overview Tab -->
      <div id="overview-tab" class="tab-content">
        <div class="bg-white rounded-lg shadow-md p-6">
          <h2 class="text-xl font-bold text-gray-800 mb-4">Recent Activity</h2>
          <div id="recent-activity" class="space-y-3">
            <!-- Activity items will be inserted here -->
          </div>
        </div>
        
        <div class="bg-white rounded-lg shadow-md p-6 mt-6">
          <h2 class="text-xl font-bold text-gray-800 mb-4">Forum Categories</h2>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4" id="categories-overview">
            <!-- Categories will be inserted here -->
          </div>
        </div>
      </div>

      <!-- Users Tab -->
      <div id="users-tab" class="tab-content hidden">
        <div class="bg-white rounded-lg shadow-md p-6">
          <h2 class="text-xl font-bold text-gray-800 mb-4">User Management</h2>
          <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-200">
              <thead class="bg-pink-50">
                <tr>
                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider">Name</th>
                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider">Email</th>
                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider">Country</th>
                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider">Joined</th>
                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider">Actions</th>
                </tr>
              </thead>
              <tbody id="users-table-body" class="bg-white divide-y divide-gray-200">
                <!-- User rows will be inserted here -->
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Threads Tab -->
      <div id="threads-tab" class="tab-content hidden">
        <div class="bg-white rounded-lg shadow-md p-6">
          <h2 class="text-xl font-bold text-gray-800 mb-4">Thread Moderation</h2>
          
          <!-- Category Filter -->
          <div class="mb-4">
            <label class="block text-sm font-medium text-gray-700 mb-2">Filter by Category:</label>
            <select
id="category-filter"
class="border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-pink-400"
onchange="filterThreadsByCategory()"
>
              <option value="all">All Categories</option>
              <option value="recipes">üç≥ Recipes</option>
              <option value="places">üó∫Ô∏è Places to Go</option>
              <option value="jobs">üíº Open Jobs</option>
              <option value="hangout">üë• Group Hangout</option>
            </select>
          </div>
          
          <div id="threads-list" class="space-y-4">
            <!-- Thread items will be inserted here -->
          </div>
        </div>
      </div>

      <!-- Posts Tab -->
      <div id="posts-tab" class="tab-content hidden">
        <div class="bg-white rounded-lg shadow-md p-6">
          <h2 class="text-xl font-bold text-gray-800 mb-4">Post Moderation</h2>
          <div id="posts-list" class="space-y-4">
            <!-- Post items will be inserted here -->
          </div>
        </div>
      </div>

    </div>
  </main>

  <!-- Delete Confirmation Modal -->
  <div id="delete-modal" class="modal">
    <div class="bg-white rounded-lg shadow-xl p-6 max-w-md mx-4">
      <h3 class="text-xl font-bold text-gray-800 mb-4">Confirm Deletion</h3>
      <p class="text-gray-600 mb-6" id="delete-message"></p>
      <div class="flex justify-end space-x-3">
        <button onclick="closeDeleteModal()" class="px-4 py-2 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400 transition-colors">
          Cancel
        </button>
        <button id="confirm-delete-btn" class="px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors">
          Delete
        </button>
      </div>
    </div>
  </div>

  <!-- Scripts -->
  <script src="./js/storage.js"></script>
  <script src="./js/forum.js"></script>
  
  <script>
    // Check if admin is logged in
    const currentAdmin = Storage.getCurrentAdmin();
    
    if (!currentAdmin) {
      window.location.href = './index.html';
    }

    // Global variables
    let currentDeleteAction = null;

    // Initialize dashboard
    document.addEventListener('DOMContentLoaded', function() {
      displayAdminInfo();
      loadStatistics();
      loadOverview();
      loadUsers();
      loadThreads();
      loadPosts();
    });

    // Display admin information
    function displayAdminInfo() {
      document.getElementById('admin-name').textContent = currentAdmin.name;
    }

    // Load statistics
    function loadStatistics() {
      const stats = Storage.getStatistics();
      document.getElementById('stat-users').textContent = stats.totalUsers;
      document.getElementById('stat-threads').textContent = stats.totalThreads;
      document.getElementById('stat-posts').textContent = stats.totalPosts;
    }

    // Load overview tab
    function loadOverview() {
      const stats = Storage.getStatistics();
      
      // Recent Activity
      const activityContainer = document.getElementById('recent-activity');
      activityContainer.innerHTML = '';
      
      if (stats.recentActivity.length === 0) {
        activityContainer.innerHTML = '<p class="text-gray-500 text-center py-4">No recent activity</p>';
      } else {
        stats.recentActivity.forEach(activity => {
          const activityItem = document.createElement('div');
          activityItem.className = 'flex items-start space-x-3 p-3 rounded-lg hover:bg-pink-50 transition-colors';
          
          const icon = activity.type === 'thread' ? 'üí¨' : activity.type === 'post' ? 'üìù' : 'üë§';
          
          activityItem.innerHTML = `
            <div class="text-2xl">${icon}</div>
            <div class="flex-1">
              <p class="text-sm text-gray-800">
                <span class="font-semibold">${activity.author}</span> ${activity.action}
                ${activity.type !== 'user' ? `<span class="font-medium">"${activity.title}"</span>` : ''}
              </p>
              <p class="text-xs text-gray-500 mt-1">${formatDate(activity.timestamp)}</p>
            </div>
          `;
          
          activityContainer.appendChild(activityItem);
        });
      }
      
      // Categories Overview
      const categoriesContainer = document.getElementById('categories-overview');
      categoriesContainer.innerHTML = '';
      
      const categories = Forum.getCategories();
      const threads = Storage.getAllThreads();
      
      categories.forEach(category => {
        const categoryThreads = threads.filter(t => t.categoryId === category.id);
        const categoryCard = document.createElement('div');
        categoryCard.className = 'p-4 border border-pink-200 rounded-lg hover:shadow-md transition-shadow';
        categoryCard.innerHTML = `
          <div class="flex items-center justify-between mb-2">
            <div class="flex items-center space-x-2">
              <span class="text-2xl">${category.icon}</span>
              <h3 class="font-semibold text-gray-800">${category.name}</h3>
            </div>
            <span class="bg-pink-100 text-pink-700 px-3 py-1 rounded-full text-sm font-medium">${categoryThreads.length}</span>
          </div>
          <p class="text-sm text-gray-600">${category.description}</p>
        `;
        categoriesContainer.appendChild(categoryCard);
      });
    }

    // Load users
    function loadUsers() {
      const users = Storage.getUsers();
      const tbody = document.getElementById('users-table-body');
      tbody.innerHTML = '';
      
      if (users.length === 0) {
        tbody.innerHTML = '<tr><td colspan="5" class="px-6 py-4 text-center text-gray-500">No users found</td></tr>';
        return;
      }
      
      users.forEach(user => {
        const row = document.createElement('tr');
        row.className = 'table-row';
        row.innerHTML = `
          <td class="px-6 py-4 whitespace-nowrap">
            <div class="text-sm font-medium text-gray-900">${user.name}</div>
          </td>
          <td class="px-6 py-4 whitespace-nowrap">
            <div class="text-sm text-gray-600">${user.email}</div>
          </td>
          <td class="px-6 py-4 whitespace-nowrap">
            <div class="text-sm text-gray-600">${user.country || 'N/A'}</div>
          </td>
          <td class="px-6 py-4 whitespace-nowrap">
            <div class="text-sm text-gray-600">${formatDate(user.createdAt)}</div>
          </td>
          <td class="px-6 py-4 whitespace-nowrap text-sm">
            <button onclick="deleteUserConfirm('${user.id}', '${user.name}')" class="text-red-600 hover:text-red-800 font-medium">
              Delete
            </button>
          </td>
        `;
        tbody.appendChild(row);
      });
    }

    // Load threads
    function loadThreads() {
      const threads = Storage.getAllThreads();
      const container = document.getElementById('threads-list');
      container.innerHTML = '';
      
      if (threads.length === 0) {
        container.innerHTML = '<p class="text-gray-500 text-center py-4">No threads found</p>';
        return;
      }
      
      // Sort by most recent
      threads.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
      
      threads.forEach(thread => {
        const category = Forum.getCategoryById(thread.categoryId);
        const threadCard = document.createElement('div');
        threadCard.className = 'border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow';
        threadCard.dataset.category = thread.categoryId;
        
        threadCard.innerHTML = `
          <div class="flex justify-between items-start mb-2">
            <div class="flex-1">
              <div class="flex items-center space-x-2 mb-2">
                <span class="text-lg">${category ? category.icon : 'üìå'}</span>
                <span class="text-xs font-medium text-gray-500 uppercase">${category ? category.name : 'Unknown'}</span>
              </div>
              <h3 class="font-semibold text-gray-800 text-lg">${thread.title}</h3>
              <p class="text-sm text-gray-600 mt-2 line-clamp-2">${thread.content}</p>
            </div>
          </div>
          <div class="flex justify-between items-center mt-3 pt-3 border-t border-gray-200">
            <div class="text-sm text-gray-500">
              <span class="font-medium">${thread.authorName}</span> ‚Ä¢ ${formatDate(thread.createdAt)} ‚Ä¢ ${thread.replyCount} replies
            </div>
            <button onclick="deleteThreadConfirm('${thread.id}', '${thread.title.replace(/'/g, "\\'")}')" class="text-red-600 hover:text-red-800 font-medium text-sm">
              Delete Thread
            </button>
          </div>
        `;
        
        container.appendChild(threadCard);
      });
    }

    // Filter threads by category
    function filterThreadsByCategory() {
      const selectedCategory = document.getElementById('category-filter').value;
      const threadCards = document.querySelectorAll('#threads-list > div');
      
      threadCards.forEach(card => {
        if (selectedCategory === 'all' || card.dataset.category === selectedCategory) {
          card.style.display = 'block';
        } else {
          card.style.display = 'none';
        }
      });
    }

    // Load posts
    function loadPosts() {
      const posts = Storage.getAllPosts();
      const threads = Storage.getAllThreads();
      const container = document.getElementById('posts-list');
      container.innerHTML = '';
      
      if (posts.length === 0) {
        container.innerHTML = '<p class="text-gray-500 text-center py-4">No posts found</p>';
        return;
      }
      
      // Sort by most recent
      posts.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
      
      posts.forEach(post => {
        const thread = threads.find(t => t.id === post.threadId);
        const postCard = document.createElement('div');
        postCard.className = 'border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow';
        
        postCard.innerHTML = `
          <div class="mb-2">
            <div class="text-xs text-gray-500 mb-1">
              Reply in: <span class="font-medium">${thread ? thread.title : 'Unknown Thread'}</span>
            </div>
            <p class="text-sm text-gray-700">${post.content}</p>
          </div>
          <div class="flex justify-between items-center mt-3 pt-3 border-t border-gray-200">
            <div class="text-sm text-gray-500">
              <span class="font-medium">${post.authorName}</span> ‚Ä¢ ${formatDate(post.createdAt)}
            </div>
            <button onclick="deletePostConfirm('${post.id}', '${post.threadId}')" class="text-red-600 hover:text-red-800 font-medium text-sm">
              Delete Post
            </button>
          </div>
        `;
        
        container.appendChild(postCard);
      });
    }

    // Switch tabs
    function switchTab(tabName) {
      // Hide all tabs
      document.querySelectorAll('.tab-content').forEach(tab => {
        tab.classList.add('hidden');
      });
      
      // Remove active class from all buttons
      document.querySelectorAll('.tab-button').forEach(btn => {
        btn.classList.remove('active');
      });
      
      // Show selected tab
      document.getElementById(tabName + '-tab').classList.remove('hidden');
      
      // Add active class to clicked button
      event.target.classList.add('active');
    }

    // Delete user confirmation
    function deleteUserConfirm(userId, userName) {
      document.getElementById('delete-message').textContent = 
        `Are you sure you want to delete user "${userName}"? This will also delete all their threads and posts. This action cannot be undone.`;
      
      currentDeleteAction = () => {
        if (Storage.deleteUserAndContent(userId)) {
          closeDeleteModal();
          loadStatistics();
          loadUsers();
          loadThreads();
          loadPosts();
          loadOverview();
          alert('User deleted successfully');
        } else {
          alert('Failed to delete user');
        }
      };
      
      document.getElementById('delete-modal').classList.add('active');
    }

    // Delete thread confirmation
    function deleteThreadConfirm(threadId, threadTitle) {
      document.getElementById('delete-message').textContent = 
        `Are you sure you want to delete the thread "${threadTitle}"? This will also delete all posts in this thread. This action cannot be undone.`;
      
      currentDeleteAction = () => {
        if (Storage.deleteThread(threadId)) {
          closeDeleteModal();
          loadStatistics();
          loadThreads();
          loadPosts();
          loadOverview();
          alert('Thread deleted successfully');
        } else {
          alert('Failed to delete thread');
        }
      };
      
      document.getElementById('delete-modal').classList.add('active');
    }

    // Delete post confirmation
    function deletePostConfirm(postId, threadId) {
      document.getElementById('delete-message').textContent = 
        `Are you sure you want to delete this post? This will also delete all replies to this post. This action cannot be undone.`;
      
      currentDeleteAction = () => {
        if (Storage.deletePost(postId, threadId)) {
          closeDeleteModal();
          loadStatistics();
          loadPosts();
          loadThreads();
          loadOverview();
          alert('Post deleted successfully');
        } else {
          alert('Failed to delete post');
        }
      };
      
      document.getElementById('delete-modal').classList.add('active');
    }

    // Close delete modal
    function closeDeleteModal() {
      document.getElementById('delete-modal').classList.remove('active');
      currentDeleteAction = null;
    }

    // Confirm delete button
    document.getElementById('confirm-delete-btn').addEventListener('click', function() {
      if (currentDeleteAction) {
        currentDeleteAction();
      }
    });

    // Format date
    function formatDate(dateString) {
      const date = new Date(dateString);
      const now = new Date();
      const diffMs = now - date;
      const diffMins = Math.floor(diffMs / 60000);
      const diffHours = Math.floor(diffMs / 3600000);
      const diffDays = Math.floor(diffMs / 86400000);

      if (diffMins < 1) return 'Just now';
      if (diffMins < 60) return `${diffMins} min${diffMins > 1 ? 's' : ''} ago`;
      if (diffHours < 24) return `${diffHours} hour${diffHours > 1 ? 's' : ''} ago`;
      if (diffDays < 7) return `${diffDays} day${diffDays > 1 ? 's' : ''} ago`;
      
      return date.toLocaleDateString('en-US', { 
        year: 'numeric', 
        month: 'short', 
        day: 'numeric' 
      });
    }

    // Logout
    function logout() {
      Storage.logout();
      window.location.href = './index.html';
    }
  </script>
</body>
</html>
